---
layout: page 
title: Patomic - Tutorial 
permalink: /tutorial.html
---

<div class="container tutorial-text">
	<div class="row">

		<div class="col-md-9" role="main">
			<div class="page-header">
				<h1 id="prerequisites">Prerequisites</h1>
			</div>
			<p>
				<h3>Installing Java JRE & JDK</h3>
					<p>
					Ubuntu 12 users should follow the guide from Digital Ocean<br />
					<a href="https://www.digitalocean.com/community/articles/how-to-install-java-on-ubuntu-with-apt-get">https://www.digitalocean.com/community/articles/how-to-install-java-on-ubuntu-with-apt-get</a><br />
					<p />
					Mac OS X users should have Java already installed.<br />
					<a href="http://stackoverflow.com/questions/14292698/how-to-check-if-java-jdk-installed-on-mac">http://stackoverflow.com/questions/14292698/how-to-check-if-java-jdk-installed-on-mac</a><br />
					<p />
					Windows 8 should have Java 7 pre-installed; feel free to updgrade to Java 8.
					</p>
				<h3>Downloading Datomic Free Edition</h3>
					<p>
					Get the latest version of Datomic Free Edition <a href="https://my.datomic.com/downloads/free">https://my.datomic.com/downloads/free</a><br />
					Once downloaded create a new directory/folder for it and unzip the file.
					</p>
				<h3>PHP >= 5.4</h3>
					<p>
					At the very minimum you will need to have PHP version 5.4.* installed on your local machine.<br />
					</p>
					<p>
					Ubuntu users follow this guide<br />
					<a href="http://askubuntu.com/questions/109404/how-do-i-install-latest-php-in-supported-ubuntu-versions-like-5-4-x-in-ubuntu-1">http://askubuntu.com/questions/109404/how-do-i-install-latest-php-in-supported-ubuntu-versions-like-5-4-x-in-ubuntu-1</a><br />
					</p>
					<p>
					Mac OS X users need to look at the Homebrew support for PHP.<br />
					<a href="https://github.com/Homebrew/homebrew-php">https://github.com/Homebrew/homebrew-php</a><br />
					</p>
					<p>
					Windows users who are familiar with IIS; which in my opinion is the best way to run PHP on Windows.<br />
					<a href="http://windows.php.net/download/">http://windows.php.net/download/</a><br />
					</p>
				<h3>Get Composer</h3>
					<p>
					Composer is needed; the exact steps will be listed later but for now just be familiar with how it works.<br />
					<a href="https://getcomposer.org/doc/00-intro.md">https://getcomposer.org/doc/00-intro.md</a>
					</p>
			</p>

			<div class="page-header">
				<h1 id="short_tutorial">Short Tutorial</h1>
			</div>
			<p>
				<h3>Launching The Datomic REST API</h3>
					<p>
					The official instructions can be found on the Datomic documentation page <a href="http://docs.datomic.com/rest.html">http://docs.datomic.com/rest.html</a>.
					For now open your terminal application and change into the directory where you unzipped Datomic Free and then start the REST service.<br />
					<pre><code>$ cd {folder_where_you_unzipped_datomic}
$ ./bin/rest -p 9998 tutorial datomic:mem://</code></pre>
					</p>
					<p>
					Open your favorite text-editor and create a new project folder; name it <b>patomic_tutorial</b>.
					Create a file within the <b>patomic_tutorial</b> directory called <b>composer.json</b>.
					<pre><code>{
    &quot;require&quot;: {
        &quot;taywils/patomic&quot;: &quot;dev-master&quot;,
        &quot;igorw/edn&quot;: &quot;1.0.*@dev&quot;,
        &quot;nikic/phlexy&quot;: &quot;1.0.*@dev&quot;
    }
}
</code></pre>
					</p>
				<h3>Creating A Database</h3>
				<p>
				Double check that you have the Datomic REST service running by visiting <a href="http://localhost:9998/">http://localhost:9998/</a>. 
				If everything is fine and well you should be greeted with the basic page which includes a description and two links. 
				Now click or copy paste the data url into your browser <a href="http://localhost:9998/data/">http://localhost:9998/data/</a>. 
				The Data page is where our storages are located; remember the &quot;tutorial&quot; storage we created when we launched the REST service? 
				To use the &quot;tutorial&quot; storage click the link or copy paste the url into your browser <a href="http://localhost:9998/data/tutorial/">http://localhost:9998/data/tutorial/</a>. 
				The REST API provides some useful tools and a decent interface but for the purposes of demonstrating Patomic lets get back to PHP. 
				For more information on using the REST API provided by Datomic <a href="http://docs.datomic.com/rest.html">http://docs.datomic.com/rest.html</a>. 
				Reopen your terminal application and run composer.phar to install the dependencies.
				<pre><code>$ cd {folder_where_you_unzipped_datomic}
$ curl -sS https://getcomposer.org/installer | php
$ sudo php composer.phar install
$ sudo php composer.phar update
</code></pre>
				<p>
				If successful you will see confirmation that the composer packages were correctly installed; now create a new file called <b>main.php</b>.<br />
				</p>
				<pre><code>&lt;?php

require_once __DIR__ . &quot;/vendor/autoload.php&quot;;

use \taywils\Patomic\Patomic;

try {
    $patomic = new Patomic(&quot;http://localhost&quot;, 9998, &quot;mem&quot;, &quot;tutorial&quot;);
    $patomic-&gt;createDatabase(&quot;seattle&quot;);
} catch(PatomicException $patomicException) {
    echo $patomicException-&gt;getMessage();
}
</code></pre>
				Verify that the database was in fact created by visiting <a href="http://localhost:9998/data/tutorial/seattle/-/">http://localhost:9998/data/tutorial/seattle/-/</a>
				</p>
				<h3>Adding A Schema</h3>
				<p>
				Next we're going to demonstrate how to load a schema from an existing .edn file. EDN is short for Extensible Data Notation and is the default format for Datomic schemas. Create a new file called <b>seattle-schema.edn</b> and copy paste the EDN provided.<br />
				<pre><code>[
 ;; community
 {:db/id #db/id[:db.part/db]
  :db/ident :community/name
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/one
  :db/fulltext true
  :db/doc &quot;A community's name&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :community/url
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A community's url&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :community/neighborhood
  :db/valueType :db.type/ref
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A community's neighborhood&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :community/category
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/many
  :db/fulltext true
  :db/doc &quot;All community categories&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :community/orgtype
  :db/valueType :db.type/ref
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A community orgtype enum value&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :community/type
  :db/valueType :db.type/ref
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A community type enum value&quot;
  :db.install/_attribute :db.part/db}

 ;; community/org-type enum values
 [:db/add #db/id[:db.part/user] :db/ident :community.orgtype/community]
 [:db/add #db/id[:db.part/user] :db/ident :community.orgtype/commercial]
 [:db/add #db/id[:db.part/user] :db/ident :community.orgtype/nonprofit]
 [:db/add #db/id[:db.part/user] :db/ident :community.orgtype/personal]

 ;; community/type enum values
 [:db/add #db/id[:db.part/user] :db/ident :community.type/email-list]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/twitter]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/facebook-page]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/blog]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/website]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/wiki]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/myspace]
 [:db/add #db/id[:db.part/user] :db/ident :community.type/ning]

 ;; neighborhood
 {:db/id #db/id[:db.part/db]
  :db/ident :neighborhood/name
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/one
  :db/unique :db.unique/identity
  :db/doc &quot;A unique neighborhood name (upsertable)&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :neighborhood/district
  :db/valueType :db.type/ref
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A neighborhood's district&quot;
  :db.install/_attribute :db.part/db}

 ;; district
 {:db/id #db/id[:db.part/db]
  :db/ident :district/name
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/one
  :db/unique :db.unique/identity
  :db/doc &quot;A unique district name (upsertable)&quot;
  :db.install/_attribute :db.part/db}

 {:db/id #db/id[:db.part/db]
  :db/ident :district/region
  :db/valueType :db.type/ref
  :db/cardinality :db.cardinality/one
  :db/doc &quot;A district region enum value&quot;
  :db.install/_attribute :db.part/db}

 ;; district/region enum values
 [:db/add #db/id[:db.part/user] :db/ident :region/n]
 [:db/add #db/id[:db.part/user] :db/ident :region/ne]
 [:db/add #db/id[:db.part/user] :db/ident :region/e]
 [:db/add #db/id[:db.part/user] :db/ident :region/se]
 [:db/add #db/id[:db.part/user] :db/ident :region/s]
 [:db/add #db/id[:db.part/user] :db/ident :region/sw]
 [:db/add #db/id[:db.part/user] :db/ident :region/w]
 [:db/add #db/id[:db.part/user] :db/ident :region/nw]
 ]</code></pre>
				Open <b>main.php</b> and create a new PatomicTransaction object, the transaction object has a method for loading .edn files.<br />
				For demonstration purposes we will be printing the transaction response from the REST API to the console.<br />
				<pre><code>&lt;?php

require_once __DIR__ . &quot;/vendor/autoload.php&quot;;

use \taywils\Patomic\Patomic;
use \taywils\Patomic\PatomicTransaction;

try {
  $patomic = new Patomic(&quot;http://localhost&quot;, 9998, &quot;mem&quot;, &quot;tutorial&quot;);
  $patomic-&gt;createDatabase(&quot;seattle&quot;);
  $patomic-&gt;setDatabase(&quot;seattle&quot;);

  $patomicTransaction = new PatomicTransaction();
  $patomicTransaction-&gt;loadFromFile(__DIR__ . DIRECTORY_SEPARATOR . &quot;seattle-schema.edn&quot;);

  $patomic-&gt;commitTransaction($patomicTransaction);
  echo $patomic-&gt;getTransactionResponse();
} catch(PatomicException $patomicException) {
  echo $patomicException-&gt;getMessage();
}
				</code></pre>
				</p>
				<h3>Loading Sample Data</h3>
				<p>
				Similar to how we loaded the schema file lets demonstrate how to load an existing .edn file consisting of data. Create a new file called <b>seattle-data0.edn</b> and copy paste the following edn data into it from the file given in the link <a href="https://github.com/taywils/patomic/blob/master/tests/seattle-data0.edn">https://github.com/taywils/patomic/blob/master/tests/seattle-data0.edn</a>.
				</p>
				Open the <b>main.php</b> file and add the code to load the data for our schema.
				<pre><code>&lt;?php

require_once __DIR__ . &quot;/vendor/autoload.php&quot;;

use \taywils\Patomic\Patomic;
use \taywils\Patomic\PatomicTransaction;

try {
  $patomic = new Patomic(&quot;http://localhost&quot;, 9998, &quot;mem&quot;, &quot;tutorial&quot;);
  $patomic-&gt;createDatabase(&quot;se&quot;);
  $patomic-&gt;setDatabase(&quot;se&quot;);

  $patomicTransaction = new PatomicTransaction();
  $patomicTransaction-&gt;loadFromFile(__DIR__ . DIRECTORY_SEPARATOR . &quot;seattle-schema.edn&quot;);

  $patomic-&gt;commitTransaction($patomicTransaction);
  echo $patomic-&gt;getTransactionResponse();

  $patomicTransaction2 = new PatomicTransaction();
  $patomicTransaction2-&gt;loadFromFile(__DIR__ . DIRECTORY_SEPARATOR . &quot;seattle-data0.edn&quot;);

  $patomic-&gt;commitTransaction($patomicTransaction2);
  echo $patomic-&gt;getTransactionResponse();
} catch(PatomicException $patomicException) {
  echo $patomicException-&gt;getMessage();
}
</code></pre>
				<p>
				Once again we're echoing out the PatomicTransaction response to the console just to show that the transaction sent was accepted by Datomic. In the next section we'll build some simple queries using the PatomicQuery class.
				</p>
				<h3>Basic Queries</h3>
				<p>
				The first type of basic query(basic in that no special Datomic knowledge is needed) we'll use is the ability to write raw Datomic queries interpreted from strings. If you already know how to construct Datomic queries then this is the by far the best approach; to do so see the below function as an example.
				</p>
				<pre><code>function rawQueryExample($patomic) {
  $patomicQuery = new PatomicQuery();
  $patomicQuery-&gt;newRawQuery(
    &quot;[:find ?neighborhood :in $ :where [?entityId :neighborhood/name ?neighborhood]]&quot;
  )-&gt;addRawQueryArgs(&quot;[{:db/alias tutorial/seattledb}]&quot;);

  $patomic-&gt;commitRawQuery($patomicQuery);

  $neighborhoodNames = $patomic-&gt;getQueryResult();

  foreach($neighborhoodNames as $row) {
    echo $row[0] . PHP_EOL;
  }
}
</code></pre>
				<p>
				Raw queries benefit the programmer already familiar with Datomic query syntax however, for the PHP programmer new to Datomic there is a more user-friendly yet less powerful way to generate queries. In this next example we'll re-create the Seattle neighborhood query from a different approach using the PatomicQuery methods. The PatomicQuery class was designed to have methods similar to the symbols used within a Datomic raw query such as :find and :where.
				</p>
				<pre><code>function regularQueryExample($patomic) {
  $patomicQuery = new PatomicQuery();
  $patomicQuery-&gt;find(&quot;neighborhood&quot;)
    -&gt;where(array(&quot;entityId&quot; =&gt; &quot;neighborhood/name&quot;, &quot;neighborhood&quot;));

  $patomic-&gt;commitRegularQuery($patomicQuery);

  $neighborhoodNames = $patomic-&gt;getQueryResult();

  foreach($neighborhoodNames as $row) {
    echo $row[&quot;neighborhood&quot;] . PHP_EOL;
  }
}</pre></code>
				<h3>Transactions</h3>
				<p>
				Transactions are created using the PatomicTransaction class and allow us to create parts of an EDN schema or add new enities to our existing schema definitions. For example if we wanted to create the following attribute for our community schema which will allow us to define a nickname.
				</p>
				<pre><code>[
 {:db/id #db/id[:db.part/db]
  :db/ident :community/nickname
  :db/valueType :db.type/string
  :db/cardinality :db.cardinality/one
  :db/fulltext true
  :db/doc &quot;A community's nickname&quot;
  :db.install/_attribute :db.part/db}
]
</code></pre>
			<p>
			The first thing we would need is to create a new entity representing the community nickname and then add the entity as a new attribute by sending it to our database within a transaction. As part of the design of Patomic the methods available to the PatomicEntity class resemble the schema attributes defined by Datomic. In fact we could have created the entire seattle-schema.edn file using Patomic but for demonstration purposes it was much easier to showcase the ability to load existing .edn files so programmers who are currently using Datomic can import their schemas into a PHP application.
			</p>
			<pre><code>function createNickNameEntity($patomic) {
  $pe = new PatomicEntity();
  $pe-&gt;ident(&quot;community&quot;, &quot;nickname&quot;)
    -&gt;valueType(&quot;string&quot;)
    -&gt;cardinality(&quot;one&quot;)
    -&gt;fullText(true)
    -&gt;doc(&quot;A community's nickname&quot;)
    -&gt;install(&quot;attribute&quot;);

  $pe-&gt;prettyPrint();

  echo PHP_EOL;

  $pt = new PatomicTransaction();
  $pt-&gt;append($pe);

  $patomic-&gt;commitTransaction($pt);

  echo $patomic-&gt;getTransactionResponse();
}
</code></pre>
			<p>
			So far we've given a brief outline of Patomic's functionality but how do we go about creating a small application from the ground up showing how we can use Datomic as a backend for a API written in PHP?
			</p>
			<p>
			Collected below is the code used in all the examples shown so far this overview.
			</p>
			<pre><code>&lt;?php

require_once __DIR__ . &quot;/vendor/autoload.php&quot;;

use \taywils\Patomic\Patomic;
use \taywils\Patomic\PatomicTransaction;
use \taywils\Patomic\PatomicQuery;
use \taywils\Patomic\PatomicEntity;

function createSchemaLoadData($patomic) {
  $patomicTransaction = new PatomicTransaction();
  $patomicTransaction-&gt;loadFromFile(__DIR__ . DIRECTORY_SEPARATOR . &quot;seattle-schema.edn&quot;);

  $patomic-&gt;commitTransaction($patomicTransaction);

  $patomicTransaction2 = new PatomicTransaction();
  $patomicTransaction2-&gt;loadFromFile(__DIR__ . DIRECTORY_SEPARATOR . &quot;seattle-data0.edn&quot;);

  $patomic-&gt;commitTransaction($patomicTransaction2);
}

function rawQueryExample($patomic) {
  $patomicQuery = new PatomicQuery();
  $patomicQuery-&gt;newRawQuery(
  &quot;[:find ?neighborhood :in $ :where [?entityId :neighborhood/name ?neighborhood]]&quot;
  )-&gt;addRawQueryArgs(&quot;[{:db/alias tutorial/seattledb}]&quot;);

  $patomic-&gt;commitRawQuery($patomicQuery);

  $neighborhoodNames = $patomic-&gt;getQueryResult();

  foreach($neighborhoodNames as $row) {
    echo $row[0] . PHP_EOL;
  }
}

function regularQueryExample($patomic) {
  $patomicQuery = new PatomicQuery();
  $patomicQuery-&gt;find(&quot;neighborhood&quot;)
    -&gt;where(array(&quot;entityId&quot; =&gt; &quot;neighborhood/name&quot;, &quot;neighborhood&quot;));

  $patomic-&gt;commitRegularQuery($patomicQuery);

  $neighborhoodNames = $patomic-&gt;getQueryResult();

  foreach($neighborhoodNames as $row) {
    echo $row[&quot;neighborhood&quot;] . PHP_EOL;
  }
}

function createNickNameEntity($patomic) {
  $pe = new PatomicEntity();
  $pe-&gt;ident(&quot;community&quot;, &quot;nickname&quot;)
    -&gt;valueType(&quot;string&quot;)
    -&gt;cardinality(&quot;one&quot;)
    -&gt;fullText(true)
    -&gt;doc(&quot;A community's nickname&quot;)
    -&gt;install(&quot;attribute&quot;);

  $pe-&gt;prettyPrint();

  echo PHP_EOL;

  $pt = new PatomicTransaction();
  $pt-&gt;append($pe);

  $patomic-&gt;commitTransaction($pt);

  echo $patomic-&gt;getTransactionResponse();
}

try {
  $patomic = new Patomic(&quot;http://localhost&quot;, 9998, &quot;mem&quot;, &quot;tutorial&quot;);
  $patomic-&gt;createDatabase(&quot;seattledb&quot;);
  $patomic-&gt;setDatabase(&quot;seattledb&quot;);

  //createSchemaLoadData($patomic);
  //rawQueryExample($patomic);
  //regularQueryExample($patomic);
  //createNickNameEntity($patomic);
} catch(PatomicException $patomicException) {
  echo $patomicException-&gt;getMessage();
}

</code></pre>
			<div class="page-header">
				<h1 id="application">Building An Application With Patomic</h1>
			</div>
			<p>
				Comming soon.
			</p>
		</div>

		<div id="myScrollspy" class="col-md-3">
			<ul class="nav nav-pills nav-stacked" data-spy="affix" data-offset-top="60"> 
				<li><a href="#prerequisites">Prerequisites</a></li>
				<li><a href="#short_tutorial">Short Tutorial</a></li>
				<li><a href="#application">Application Dev</a></li>
			</ul>
		</div>
	</div> <!-- row -->

</div> <!-- container -->
